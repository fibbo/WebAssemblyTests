<html>
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="css/styles.css">

  <script>
    var Module = Module !== undefined ? Module : {};
    Module.dynamicLibraries = ['modules_advanced/bin/side_module.wasm', 'modules_advanced/bin/side_module2.wasm'];
    Module['onRuntimeInitialized'] = () =>
    {
        console.log('onruntimeinitialized');

        Module.NewDeleteMainModule();
        Module.NewDeleteSideModule();
        Module.NewMainDeleteSideModule();
        Module.NewSideDeleteMainModule();

        Module.setSampleCount(500000);
        Module.PointTestWithinModule();
        Module.PointTestAcrossModule();
    }
  </script>
  <script type="text/javascript" src="modules_advanced/bin/main.js"></script>

</head>
<body>
    <h1>Modules: Dynamic Linking with Module.dynamicLibraries </h1>

    Modules are loaded on page load by defining a list of module names (Module.dynamicLibraries = ['module1.wasm', 'module2.wasm']) that WASM will link once loaded.

    <h2>Tests that are being run</h2>
    <ol>
      <li>NewDeleteMainModule: Create and delete 6000000 non-trivial objects in the main module</li>
      <li>NewDeleteSideModule: Create and delete 6000000 non-trivial objects in the side module</li>
      <li>NewMainDeleteSideModule and NewSideDeleteMainModule: When mixing allocation and deletion in both modules it seems to be faster when deleting in the main module (and allocating in the side module).</li>
      <li> The following is once done purely in the main module and the second time all the function calls go into a side module. For example for creating the points
          a function in side_module.wasm is called which returns a point.
        <ol> 
          <li>Create 500000 points with random coordinates between [0,1) for x and y and store them in a vector</li>
          <li>Calculate distance between i-1 and i from i=1 to i=500000 and store results in another vector</li>
          <li>Calculate average distance between the points and print result</li>
        </ol>
      </li>
    </ol>
</body>
</html>